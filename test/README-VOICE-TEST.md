# 云托管语音识别功能测试指南

## 📋 测试脚本

`test/test-voice-recognition-cloud.js` - 云托管语音识别功能完整测试脚本

## 🚀 使用方法

```bash
node test/test-voice-recognition-cloud.js
```

## ✅ 测试内容

### 1. 健康检查
- **接口**: `GET /health`
- **说明**: 检查服务是否正常运行
- **状态**: ✅ 已通过

### 2. 登录获取Token
- **接口**: `POST /api/auth/test-login` 或 `POST /api/auth/login`
- **说明**: 获取JWT token用于后续认证
- **状态**: ⚠️ 需要配置

**解决方案**:
- **方案1**: 在数据库中创建测试用户
  ```sql
  INSERT INTO users (openid, nickname) VALUES ('test_openid_888888', '测试用户');
  ```
- **方案2**: 使用真实的微信code进行登录（需要从小程序获取）

### 3. 语音识别（一句话识别）
- **接口**: `POST /api/realtime-voice-socketio/recognize`
- **说明**: 上传音频文件进行识别
- **需要**: Token认证
- **参数**:
  - `audio`: 音频文件（multipart/form-data）
  - `engineType`: 识别引擎类型（默认: 16k_zh）
  - `filterDirty`: 是否过滤脏词（0或1）
  - `filterModal`: 是否过滤语气词（0或1）
  - `convertNumMode`: 是否转换数字（0或1）
  - `wordInfo`: 词信息级别（0-2）

### 4. 获取识别历史记录
- **接口**: `GET /api/realtime-voice-socketio/history`
- **说明**: 获取用户的识别历史记录
- **需要**: Token认证
- **参数**:
  - `page`: 页码（默认: 1）
  - `pageSize`: 每页数量（默认: 10）

### 5. 获取识别统计信息
- **接口**: `GET /api/realtime-voice-socketio/stats`
- **说明**: 获取用户的识别统计信息
- **需要**: Token认证

## 🔧 配置说明

测试脚本默认配置：
- **服务地址**: `https://api.yimengpl.com`
- **协议**: HTTPS

如需修改，编辑 `test/test-voice-recognition-cloud.js` 中的 `config` 对象。

## 📝 测试结果示例

```
╔═══════════════════════════════════════════════════════════╗
║         云托管语音识别功能测试                           ║
╚═══════════════════════════════════════════════════════════╝

📋 测试配置:
   服务地址: https://api.yimengpl.com
   测试Code: test_wechat_code_xxx

🧪 测试1: 健康检查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 健康检查通过
   状态码: 200

🧪 测试2: 登录获取Token
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 测试登录成功
   Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   用户ID: 1

🧪 测试3: 语音识别（一句话识别）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 语音识别成功
   识别文本: 这是测试语音内容
   音频时长: 1.5 秒
   记录ID: 123

🧪 测试4: 获取识别历史记录
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 获取历史记录成功
   记录数量: 5
   总数: 10

🧪 测试5: 获取识别统计信息
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 获取统计信息成功
   总识别次数: 10
   总音频大小: 1024 KB
   总音频时长: 60 秒
```

## ⚠️ 注意事项

1. **音频格式**: 测试脚本使用模拟音频数据，实际测试建议使用真实音频文件
2. **音频要求**: 
   - 格式: PCM（推荐）或MP3
   - 采样率: 16kHz
   - 声道: 单声道
   - 时长: 60秒以内（一句话识别）
3. **Token有效期**: JWT token默认有效期为7天
4. **网络要求**: 需要稳定的网络连接访问云托管服务

## 🐛 常见问题

### 1. 健康检查失败
- 检查服务是否正常运行
- 检查域名是否正确
- 检查网络连接

### 2. 登录失败
- 确保数据库中有测试用户
- 或使用真实的微信code
- 检查数据库连接配置

### 3. 语音识别失败
- 检查腾讯云语音识别服务配置
- 检查音频格式是否正确
- 检查网络连接

## 📚 相关文档

- [语音识别功能文档](../docs/VOICE_RECOGNITION.md)
- [实时语音识别文档](../README_REALTIME_VOICE.md)
- [Socket.IO云托管集成指南](../docs/Socket.IO云托管集成指南.md)

