# 🚀 云部署API快速验证指南

## 三种验证方式

### 方式1️⃣: 交互式验证（推荐新手） ⭐⭐⭐

**最简单！一步步引导你完成验证**

```bash
npm run verify-interactive
```

然后按照提示输入你的云部署地址，脚本会自动引导你完成所有测试。

---

### 方式2️⃣: 快速验证（推荐日常使用） ⭐⭐⭐

**最快速！一键验证所有关键接口**

```bash
# 直接传入URL
node test/quick-verify.js https://your-cloud-url.com

# 或使用npm脚本
export API_BASE_URL="https://your-cloud-url.com"
npm run verify-quick
```

**输出示例:**
```
🚀 快速API验证
============================================================
📍 测试地址: https://your-cloud-url.com

1️⃣  健康检查
✅ 服务健康状态

2️⃣  环境诊断
✅ 环境配置正常

...

🎉 所有关键接口验证通过！
```

---

### 方式3️⃣: 完整验证（推荐深度测试）

**最全面！测试所有接口和边界情况**

```bash
export API_BASE_URL="https://your-cloud-url.com"
npm run verify-api
```

---

## 浏览器快速验证

如果你不想用命令行，直接在浏览器打开这些URL：

### ✅ 必须检查的3个接口

1. **健康检查** - 最重要！
   ```
   https://your-cloud-url.com/health
   ```
   期望看到: `{"status":"ok",...}`

2. **环境诊断** - 检查配置！
   ```
   https://your-cloud-url.com/diagnose
   ```
   期望看到: `diagnosis.warning` 为 `null`

3. **项目列表** - 测试业务接口！
   ```
   https://your-cloud-url.com/api/projects?page=1&pageSize=10
   ```
   期望看到: `{"code":0,"message":"获取项目列表成功",...}`

---

## 常见问题速查

### ❌ 健康检查失败

**问题**: 无法访问 `/health`

**解决**:
```bash
# 1. 检查URL是否正确
# 2. 检查服务是否启动
# 3. 查看云托管日志
```

---

### ❌ 环境诊断警告

**问题**: 显示 "数据库地址是本地地址"

**解决**:
```bash
# 在云托管环境变量中设置:
NODE_ENV=production
DB_HOST_INTERNAL=内网地址
DB_PORT_INTERNAL=3306
DB_USER=用户名
DB_PASSWORD=密码
DB_NAME=数据库名
```

---

### ❌ 天气API失败

**问题**: 天气查询返回错误

**解决**:
```bash
# 在云托管环境变量中设置:
QWEATHER_KEY=你的和风天气密钥
```

---

### ❌ 权限保护失效

**问题**: 未登录可以创建资源

**解决**:
检查路由是否使用了 `authenticate` 中间件，查看最近的权限修复提交。

---

## 验证成功后的下一步

✅ **所有测试通过？恭喜！**

现在可以：

1. **配置小程序域名**
   - 在微信公众平台配置服务器域名
   - 添加你的云部署地址

2. **测试小程序登录**
   - 打开小程序开发者工具
   - 测试登录功能

3. **测试完整功能**
   - 创建项目
   - 添加工程
   - 记录监理日志
   - 上传附件
   - 导出Word文档

---

## 需要帮助？

📖 **详细文档**:
- [API接口验证指南](./API接口验证指南.md) - 完整的验证指南
- [test/README.md](../test/README.md) - 测试工具使用说明

🔧 **问题排查**:
- [权限修复总结](./权限修复总结.md)
- [AI对话优化修复总结](./AI对话优化修复总结.md)

---

## 快速命令参考

```bash
# 交互式验证（推荐新手）
npm run verify-interactive

# 快速验证（推荐日常）
node test/quick-verify.js https://your-url.com

# 完整验证（推荐深度测试）
export API_BASE_URL="https://your-url.com"
npm run verify-api

# 数据库连接测试
npm run test-db

# 语音识别测试
npm run test-voice
```

---

**最后更新**: 2024-11-08
**适用版本**: v1.0.0

