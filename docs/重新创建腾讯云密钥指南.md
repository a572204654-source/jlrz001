# 重新创建腾讯云密钥指南

## 为什么需要重新创建密钥？

**重要提示**：自 2023 年 11 月 30 日起，腾讯云已关闭查询 SecretKey 的功能。SecretKey 只能在创建时查看一次，之后无法查询。

如果你在创建密钥时没有保存 SecretKey，或者 SecretKey 配置不正确，需要重新创建密钥。

## 📋 重新创建步骤

### 步骤1：创建新密钥

1. 访问 [腾讯云 API 密钥管理](https://console.cloud.tencent.com/cam/capi)
2. 点击 **"新建密钥"** 按钮
3. 创建成功后，**立即复制并保存**以下信息：
   - **SecretId**：例如 `AKIDxxxxxxxxxxxxxxxxxx`
   - **SecretKey**：例如 `xxxxxxxxxxxxxxxxxxxxxxxxxx`（**只显示一次，务必保存**）
   - **AppId**：例如 `1302271970`（在密钥列表的 APPID 列可以看到）

⚠️ **重要**：
- SecretKey 只显示一次，请立即复制保存
- 建议保存到安全的地方（如密码管理器）
- 不要截图保存（可能泄露）

### 步骤2：更新配置文件

编辑 `config/cloudbase-env.txt`，更新以下配置：

```bash
# 腾讯云语音识别配置
TENCENT_SECRET_ID=你的新SecretId
TENCENT_SECRET_KEY=你的新SecretKey（完整复制，不要有空格）
TENCENT_APP_ID=1302271970
TENCENT_REGION=ap-guangzhou
```

### 步骤3：更新云托管环境变量

1. 登录 [CloudBase 云托管控制台](https://console.cloud.tencent.com/tcb)
2. 选择你的环境和服务
3. 进入 **"配置管理"** > **"环境变量"**
4. 更新以下环境变量：
   - `TENCENT_SECRET_ID` = 你的新 SecretId
   - `TENCENT_SECRET_KEY` = 你的新 SecretKey（完整复制）
5. 点击 **"保存"** 并 **"重启服务"**

### 步骤4：验证配置

服务重启后，运行测试脚本验证：

```bash
node test/test-voice-recognition-cloud.js
```

如果看到以下信息，说明配置成功：

```
✓ TENCENT_SECRET_ID: 已配置 (AKIDxxxxx...)
✓ TENCENT_SECRET_KEY: 已配置 (xxxxx...)
✓ 语音识别测试成功
```

## ✅ 关于权限

**主账号的 API 密钥默认拥有所有权限，包括语音识别（ASR）服务权限，无需单独设置。**

权限设置功能主要针对子账号。如果你使用的是主账号密钥，不需要担心权限问题。

## 🔒 安全建议

1. **妥善保存 SecretKey**
   - 创建后立即保存到安全的地方
   - 不要提交到代码仓库
   - 不要通过聊天工具分享

2. **定期轮换密钥**
   - 建议每 3-6 个月更换一次
   - 更换后及时更新所有使用该密钥的服务

3. **使用子账号密钥（可选）**
   - 创建子账号并授予最小权限
   - 使用子账号密钥而非主账号密钥
   - 提高安全性，降低风险

## ❓ 常见问题

### Q1: 创建新密钥后，旧密钥还能用吗？

**A**: 可以。创建新密钥不会影响旧密钥。你可以：
- 继续使用旧密钥（如果 SecretKey 已知）
- 或禁用旧密钥，只使用新密钥

### Q2: 如何禁用旧密钥？

**A**: 在 API 密钥管理页面，找到旧密钥，点击 **"禁用"** 按钮。

### Q3: SecretKey 看起来很短，是否完整？

**A**: SecretKey 的长度不固定，通常在 30-40 个字符。只要是从创建页面完整复制的，就是正确的。

### Q4: 配置后仍然报错？

**A**: 请检查：
1. SecretKey 是否完整（无多余空格）
2. 环境变量名称是否正确（区分大小写）
3. 服务是否已重启
4. 密钥是否已启用（状态为"已启用"）

