# 环境变量名更新说明

## 📋 更新内容

根据腾讯云云托管的标准规范，项目已更新为支持标准环境变量名，同时保持向后兼容。

## 🔄 环境变量名变更

### 标准环境变量名（推荐）

腾讯云云托管推荐使用以下标准环境变量名：

- `TENCENTCLOUD_SECRET_ID` - 存储API密钥ID
- `TENCENTCLOUD_SECRET_KEY` - 存储API密钥内容

### 兼容环境变量名（向后兼容）

代码仍然支持以下旧变量名，但建议迁移到标准名称：

- `TENCENT_SECRET_ID` - 存储API密钥ID（兼容）
- `TENCENT_SECRET_KEY` - 存储API密钥内容（兼容）

## ✅ 代码更新

### 1. 配置文件更新

`config/index.js` 已更新，优先使用标准变量名：

```javascript
tencentCloud: {
  // 优先使用标准环境变量名，向后兼容旧变量名
  secretId: process.env.TENCENTCLOUD_SECRET_ID || process.env.TENCENT_SECRET_ID || '',
  secretKey: process.env.TENCENTCLOUD_SECRET_KEY || process.env.TENCENT_SECRET_KEY || '',
  // ...
}
```

### 2. 诊断脚本更新

`scripts/diagnose-cloud-env.js` 已更新：
- 优先检查标准变量名
- 如果使用兼容变量名，会提示建议使用标准名称
- 同时检查两种变量名，确保兼容性

### 3. 应用诊断接口更新

`app.js` 中的诊断接口已更新，支持两种变量名。

## 📝 迁移指南

### 对于新部署

**直接使用标准环境变量名**：

```bash
TENCENTCLOUD_SECRET_ID=你的SecretId
TENCENTCLOUD_SECRET_KEY=你的SecretKey
TENCENT_APP_ID=你的AppId
TENCENT_REGION=ap-guangzhou
```

### 对于现有部署

**无需立即迁移**，代码会自动兼容旧变量名。但建议逐步迁移到标准名称：

1. 在云托管控制台添加标准环境变量：
   ```
   TENCENTCLOUD_SECRET_ID=你的SecretId
   TENCENTCLOUD_SECRET_KEY=你的SecretKey
   ```

2. 重启服务验证功能正常

3. 删除旧环境变量（可选）：
   ```
   TENCENT_SECRET_ID
   TENCENT_SECRET_KEY
   ```

## 🔍 验证方法

### 方法1：使用诊断脚本

```bash
# 检查本地配置
node scripts/diagnose-cloud-env.js

# 检查云托管配置
node scripts/diagnose-cloud-env.js https://api.yimengpl.com
```

如果使用兼容变量名，诊断脚本会提示：
```
⚠️ 建议使用标准环境变量名 TENCENTCLOUD_SECRET_ID 替代 TENCENT_SECRET_ID
⚠️ 建议使用标准环境变量名 TENCENTCLOUD_SECRET_KEY 替代 TENCENT_SECRET_KEY
```

### 方法2：查看诊断接口

访问 `/diagnose` 接口，查看 `tencentCloud.usingStandardVars` 字段：
- `true` - 使用标准变量名
- `false` - 使用兼容变量名

## 📚 相关文档

- [快速修复指南](./QUICK_FIX_CLOUD_CONFIG.md) - 包含标准变量名配置说明
- [配置检查清单](./CLOUD_DEPLOYMENT_CHECKLIST.md) - 包含完整配置说明
- [检查结果报告](./CLOUD_ENV_CHECK_RESULT.md) - 包含问题诊断和解决方案

## ⚠️ 注意事项

1. **变量名区分大小写**：确保使用正确的大小写
2. **不要同时配置两种变量名**：如果同时配置，标准变量名会优先使用
3. **迁移时不要删除旧变量**：先添加新变量，验证功能正常后再删除旧变量
4. **重启服务**：修改环境变量后必须重启服务才能生效

## 🎯 最佳实践

1. **新项目**：直接使用标准环境变量名
2. **现有项目**：逐步迁移到标准名称
3. **文档更新**：所有新文档使用标准变量名
4. **代码检查**：使用诊断脚本定期检查配置

---

**更新日期**：2024-11-06  
**版本**：v1.1.0

