# 腾讯云密钥获取指南

## 📍 获取位置

### 方法一：直接访问（推荐）

访问：**https://console.cloud.tencent.com/cam/capi**

### 方法二：通过控制台导航

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 点击右上角头像，选择 **"访问管理"**
3. 在左侧菜单选择 **"API密钥管理"**

---

## 🔑 获取步骤

### 1. 进入API密钥管理页面

![API密钥管理入口](https://console.cloud.tencent.com/cam/capi)

### 2. 查看或创建密钥

#### 如果已有密钥：
- 点击 **"显示"** 按钮查看 `SecretKey`
- 复制 `SecretId` 和 `SecretKey`

#### 如果没有密钥：
- 点击 **"新建密钥"** 按钮
- 按照提示完成创建
- 复制 `SecretId` 和 `SecretKey`

⚠️ **重要提示**：
- `SecretKey` 只在创建时显示一次，请妥善保存
- 如果忘记 `SecretKey`，需要重新创建密钥

---

## 🔐 配置到云托管

### 方式一：通过云托管控制台配置

1. 登录 [CloudBase 云托管控制台](https://console.cloud.tencent.com/tcb)
2. 选择你的环境和服务
3. 进入 **"配置管理"** > **"环境变量"**
4. 添加以下环境变量：

```
TENCENT_SECRET_ID=AKIDxxxxxxxxxxxxxxxxxx
TENCENT_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxx
TENCENT_APP_ID=1234567890（可选）
TENCENT_REGION=ap-guangzhou
```

5. 点击 **"保存"** 并 **"重启服务"** 使配置生效

### 方式二：使用配置文件

编辑 `config/cloudbase-env.txt` 文件，填入你的密钥：

```bash
TENCENT_SECRET_ID=你的SecretId
TENCENT_SECRET_KEY=你的SecretKey
TENCENT_APP_ID=你的AppId（可选）
TENCENT_REGION=ap-guangzhou
```

然后在云托管控制台选择 **"配置文本输入"**，复制文件内容粘贴。

---

## ✅ 权限要求

确保你的腾讯云密钥有以下权限：

- ✅ **语音识别（ASR）** - 必需
- ✅ **自动语音识别** - 必需

### 检查权限

1. 在API密钥管理页面，点击密钥右侧的 **"权限"** 按钮
2. 确保已勾选 **"语音识别"** 相关权限
3. 如果没有权限，需要联系主账号管理员授权

---

## 🌍 区域选择

`TENCENT_REGION` 可选值：

- `ap-guangzhou` - 广州（推荐，延迟低）
- `ap-shanghai` - 上海
- `ap-beijing` - 北京
- `ap-chengdu` - 成都

建议选择距离你服务器最近的区域，以获得更低的延迟。

---

## 🧪 验证配置

配置完成后，运行测试脚本验证：

```bash
node test/test-voice-recognition-cloud.js
```

如果看到以下信息，说明配置成功：

```
✓ TENCENT_SECRET_ID: 已配置 (AKIDxxxxx...)
✓ TENCENT_SECRET_KEY: 已配置 (xxxxx...)
```

如果出现 `签名验证失败` 错误，请检查：
1. 密钥是否正确（无多余空格）
2. 密钥是否有ASR服务权限
3. 服务是否已重启

---

## 🔒 安全建议

1. **不要将密钥提交到代码仓库**
   - `.env` 文件已加入 `.gitignore`
   - 不要在代码中硬编码密钥

2. **定期轮换密钥**
   - 建议每3-6个月更换一次密钥
   - 更换后及时更新环境变量

3. **使用子账号密钥**
   - 创建子账号并授予最小权限
   - 使用子账号密钥而非主账号密钥

4. **限制密钥权限**
   - 只授予必要的服务权限
   - 不要授予全权限

---

## ❓ 常见问题

### Q1: 找不到API密钥管理入口？

**A**: 确保你使用的是主账号或具有访问管理权限的子账号。

### Q2: 密钥显示为星号，如何查看？

**A**: 点击 **"显示"** 按钮，需要验证身份（手机验证码或邮箱验证码）。

### Q3: 忘记SecretKey怎么办？

**A**: SecretKey无法找回，需要重新创建密钥。创建新密钥后，记得更新所有使用该密钥的服务。

### Q4: 密钥有权限但依然报错？

**A**: 
1. 检查密钥是否正确（复制时注意不要有多余空格）
2. 确认服务已重启使配置生效
3. 检查区域配置是否正确

### Q5: 如何查看密钥的使用情况？

**A**: 在API密钥管理页面，点击密钥右侧的 **"使用记录"** 可以查看调用情况。

---

## 📞 获取帮助

如果遇到问题，可以：

1. 查看 [腾讯云API密钥文档](https://cloud.tencent.com/document/product/598/34578)
2. 联系腾讯云技术支持
3. 查看项目文档：`docs/语音识别功能配置指南.md`

---

**最后更新**: 2024-11-06

